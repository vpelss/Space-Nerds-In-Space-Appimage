#My build instructions to create a Linux AppImage distribution for Space Nerds in Space
#https://github.com/smcameron/space-nerds-in-space
#My github action build was build using ubuntu 22.04

#As per the following:
#https://smcameron.github.io/space-nerds-in-space/

#util/install_dependencies # I said yes to all
sudo apt-get -y install build-essential portaudio19-dev libpng-dev libvorbis-dev libsdl2-dev libsdl2-2.0-0 liblua5.2-dev libglew-dev libttspico-utils sox espeak alsa-utils

git clone --depth 1 https://github.com/smcameron/space-nerds-in-space.git
SnisGitDir='space-nerds-in-space'
cd $SnisGitDir

make
make update-assets

cd ..
AppDir='SpaceNerdsInSpaceDir'
mkdir -p $AppDir/usr/bin
mkdir -p $AppDir/usr/lib
cp -r $SnisGitDir/bin $AppDir/usr/bin
cp -r $SnisGitDir/*.png $AppDir/usr/bin
cp $SnisGitDir/snis_launcher $AppDir/usr/bin
cp -r $SnisGitDir/share $AppDir/usr/bin
#get pesky lib files
ldd $AppDir/usr/bin/bin/snis_client | awk -v AppDir=$AppDir  'NF == 4 { echo system("cp " $3 " " AppDir "/usr/lib/") }'
#rm $AppDir/usr/lib/libc.*

git clone --depth 1 https://github.com/vpelss/Space-Nerds-In-Space-Appimage.git
SnisAppImageToolsDir='Space-Nerds-In-Space-Appimage'

cp $SnisAppImageToolsDir/AppRun SpaceNerdsInSpaceDir
cp $SnisAppImageToolsDir/icon.png SpaceNerdsInSpaceDir
cp $SnisAppImageToolsDir/snis.desktop SpaceNerdsInSpaceDir

#set permissions
chmod +x $AppDir/AppRun 
chmod +x $AppDir/usr/bin/snis_launcher
chmod +x $AppDir/usr/bin/bin/*
chmod +x $AppDir/snis.desktop

# get linuxdeploy's AppImage if you donâ€™t have it
wget https://github.com/linuxdeploy/linuxdeploy/releases/download/continuous/linuxdeploy-x86_64.AppImage
chmod +x linuxdeploy-x86_64.AppImage

#run linuxdeploy and fix up generate an AppDir (add lib) and build AppImage 
ARCH=x86_64 ./linuxdeploy-x86_64.AppImage --appdir=$AppDir --output appimage

chmod 777 Space_Nerds_in_Space-x86_64.AppImage

#run it
printf '0' |./Space_Nerds_in_Space-x86_64.AppImage

